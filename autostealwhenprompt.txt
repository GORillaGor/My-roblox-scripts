local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local ProximityPromptService = game:GetService("ProximityPromptService")

-- === GUI SETUP ===
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SuperRobloxEnhancer"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 400, 0, 0)
frame.Position = UDim2.new(0.5, -200, 0.8, -173)
frame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.ClipsDescendants = true
frame.Parent = screenGui

local uicorner = Instance.new("UICorner", frame)
uicorner.CornerRadius = UDim.new(0, 18)

local shadow = Instance.new("ImageLabel")
shadow.Name = "Shadow"
shadow.BackgroundTransparency = 1
shadow.Image = "rbxassetid://1316045217"
shadow.Size = UDim2.new(1, 24, 1, 24)
shadow.Position = UDim2.new(-0.03, 0, -0.03, 0)
shadow.ImageColor3 = Color3.fromRGB(0,0,0)
shadow.ImageTransparency = 0.7
shadow.ZIndex = 0
shadow.Parent = frame

local headerBar = Instance.new("Frame")
headerBar.Size = UDim2.new(1, 0, 0, 46)
headerBar.BackgroundColor3 = Color3.fromRGB(31, 31, 31)
headerBar.BorderSizePixel = 0
headerBar.Parent = frame
headerBar.ZIndex = 2
local headerBarCorner = Instance.new("UICorner", headerBar)
headerBarCorner.CornerRadius = UDim.new(0, 18)

local header = Instance.new("TextLabel")
header.Text = "✨ Super Roblox Enhancer"
header.Size = UDim2.new(1, -100, 1, 0)
header.Position = UDim2.new(0, 16, 0, 0)
header.BackgroundTransparency = 1
header.Font = Enum.Font.GothamBlack
header.TextSize = 24
header.TextStrokeTransparency = 0.7
header.TextColor3 = Color3.fromRGB(235,235,235)
header.TextXAlignment = Enum.TextXAlignment.Left
header.ZIndex = 3
header.Parent = headerBar

local closeButton = Instance.new("TextButton")
closeButton.Text = "✕"
closeButton.Size = UDim2.new(0, 36, 0, 36)
closeButton.Position = UDim2.new(1, -44, 0.5, -18)
closeButton.BackgroundColor3 = Color3.fromRGB(220, 55, 66)
closeButton.TextColor3 = Color3.fromRGB(255,255,255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 22
closeButton.ZIndex = 4
closeButton.BorderSizePixel = 0
closeButton.Parent = headerBar
local closeUICorner = Instance.new("UICorner", closeButton)
closeUICorner.CornerRadius = UDim.new(1,0)

local minimizeButton = Instance.new("TextButton")
minimizeButton.Text = "_"
minimizeButton.Size = UDim2.new(0, 34, 0, 34)
minimizeButton.Position = UDim2.new(1, -86, 0.5, -17)
minimizeButton.BackgroundColor3 = Color3.fromRGB(38, 38, 38)
minimizeButton.TextColor3 = Color3.fromRGB(210,210,210)
minimizeButton.Font = Enum.Font.GothamBold
minimizeButton.TextSize = 30
minimizeButton.ZIndex = 4
minimizeButton.BorderSizePixel = 0
minimizeButton.Parent = headerBar
local minUICorner = Instance.new("UICorner", minimizeButton)
minUICorner.CornerRadius = UDim.new(1,0)

local contentFrame = Instance.new("Frame")
contentFrame.Name = "Content"
contentFrame.Size = UDim2.new(1, 0, 1, -46)
contentFrame.Position = UDim2.new(0, 0, 0, 46)
contentFrame.BackgroundColor3 = Color3.fromRGB(27,27,27)
contentFrame.BorderSizePixel = 0
contentFrame.Parent = frame
local contentCorner = Instance.new("UICorner", contentFrame)
contentCorner.CornerRadius = UDim.new(0, 0)

-- Status rows layout
local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = contentFrame
UIListLayout.Padding = UDim.new(0, 8)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

local function statusRow(text, idx)
    local label = Instance.new("TextLabel")
    label.Text = text
    label.Size = UDim2.new(1, -32, 0, 32)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 18
    label.TextColor3 = Color3.fromRGB(210, 210, 210)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.LayoutOrder = idx
    label.Parent = contentFrame
    return label
end

local status1 = statusRow("RobberyDeposit: Size 2048³ (auto)", 1)
local status2 = statusRow('Deleted all folders named "Barrier"', 2)
local status3 = statusRow('Deleted all folders named "Build"', 3)
local status4 = statusRow("Speed: 100 (auto)", 4)
local status5 = statusRow("Infinite Jump: Enabled", 5)
local status6 = statusRow('Steal/Sell Prompts: Infinite, Instant, Loop', 6)

local toggleRow = Instance.new("Frame")
toggleRow.Size = UDim2.new(1, -32, 0, 32)
toggleRow.BackgroundTransparency = 1
toggleRow.LayoutOrder = 7
toggleRow.Parent = contentFrame

local status7 = Instance.new("TextLabel")
status7.Text = "Prompt TP+Activate: "
status7.Size = UDim2.new(1, -70, 1, 0)
status7.Position = UDim2.new(0, 0, 0, 0)
status7.BackgroundTransparency = 1
status7.Font = Enum.Font.Gotham
status7.TextSize = 18
status7.TextColor3 = Color3.fromRGB(210, 210, 210)
status7.TextXAlignment = Enum.TextXAlignment.Left
status7.Parent = toggleRow

local toggleBtn = Instance.new("TextButton")
toggleBtn.Text = "ON"
toggleBtn.Size = UDim2.new(0, 50, 1, -4)
toggleBtn.Position = UDim2.new(1, -54, 0, 2)
toggleBtn.AnchorPoint = Vector2.new(1,0)
toggleBtn.BackgroundColor3 = Color3.fromRGB(33, 200, 112)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 16
toggleBtn.Parent = toggleRow
toggleBtn.BorderSizePixel = 0
local toggleUICorner = Instance.new("UICorner", toggleBtn)
toggleUICorner.CornerRadius = UDim.new(1,0)

-- === ANIMATION AND MINIMIZE ===
local openSize = UDim2.new(0, 400, 0, 346)
local minSize = UDim2.new(0, 400, 0, 62)
local openContentVisible = true
local minimized = false
local lastPos = frame.Position

local function tween(obj, info, prop)
    local t = TweenService:Create(obj, TweenInfo.new(info.t or 0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), prop)
    t:Play()
    return t
end

local function setMinimized(state)
    minimized = state
    if state then
        lastPos = frame.Position
        tween(frame, {t=0.22}, {Size = minSize})
        contentFrame.Visible = false
        minimizeButton.Text = "+"
    else
        frame.Position = lastPos
        tween(frame, {t=0.22}, {Size = openSize})
        task.delay(0.18, function() contentFrame.Visible = true end)
        minimizeButton.Text = "_"
    end
end

minimizeButton.MouseButton1Click:Connect(function()
    setMinimized(not minimized)
end)

local function openAnim()
    frame.Size = UDim2.new(0, 400, 0, 0)
    contentFrame.Visible = false
    local t = tween(frame, {t=0.32}, {Size=openSize})
    task.delay(0.24, function() contentFrame.Visible = true end)
end

local function closeAnimAndDestroy()
    contentFrame.Visible = false
    local t = tween(frame, {t=0.23}, {Size=UDim2.new(0, 400, 0, 0)})
    t.Completed:Wait()
    screenGui:Destroy()
end

closeButton.MouseButton1Click:Connect(closeAnimAndDestroy)

-- Make frame not snap to initial pos after minimize/maximize (keep lastPos)
local dragging = false
local dragInput, dragStart, startPos

headerBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                lastPos = frame.Position
            end
        end)
    end
end)

headerBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UIS.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        lastPos = frame.Position
    end
end)

openAnim()

-- === FUNCTIONALITY (unchanged) ===

local targetSize = Vector3.new(2048, 2048, 2048)
local function resizeRobberyDeposit(part)
    if part:IsA("BasePart") and part.Name == "RobberyDeposit" then
        if (part.Size - targetSize).magnitude > 0.1 then
            part.Size = targetSize
        end
    end
end

for _, obj in ipairs(workspace:GetDescendants()) do
    if obj:IsA("BasePart") and obj.Name == "RobberyDeposit" then
        resizeRobberyDeposit(obj)
    end
end

workspace.DescendantAdded:Connect(function(obj)
    if obj:IsA("BasePart") and obj.Name == "RobberyDeposit" then
        resizeRobberyDeposit(obj)
    end
end)

task.spawn(function()
    while true do
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") and obj.Name == "RobberyDeposit" then
                resizeRobberyDeposit(obj)
            end
        end
        task.wait(2)
    end
end)

local function delBarrierBuild(obj)
    if obj:IsA("Folder") and (obj.Name == "Barrier" or obj.Name == "Build") then
        pcall(function() obj:Destroy() end)
    end
end

for _, obj in ipairs(workspace:GetDescendants()) do
    delBarrierBuild(obj)
end

workspace.DescendantAdded:Connect(function(obj)
    delBarrierBuild(obj)
end)

task.spawn(function()
    while true do
        for _, obj in ipairs(workspace:GetDescendants()) do
            delBarrierBuild(obj)
        end
        task.wait(2)
    end
end)

task.spawn(function()
    while true do
        local char = player.Character or player.CharacterAdded:Wait()
        local hum = char and char:FindFirstChildWhichIsA("Humanoid")
        if hum and hum.WalkSpeed ~= 100 then
            hum.WalkSpeed = 100
        end
        task.wait(0.2)
    end
end)

UIS.JumpRequest:Connect(function()
    local char = player.Character
    local hum = char and char:FindFirstChildWhichIsA("Humanoid")
    if hum then
        hum:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

local function isStealOrSellPrompt(prompt)
    local text = string.lower((prompt.ObjectText or "") .. (prompt.ActionText or ""))
    return string.find(text, "steal") or string.find(text, "sell")
end

local function enableStealOrSellPrompt(prompt)
    prompt.MaxActivationDistance = math.huge
    prompt.RequiresLineOfSight = false
    prompt.Exclusivity = Enum.ProximityPromptExclusivity.OneGlobally
    prompt.Enabled = true
    prompt.Style = Enum.ProximityPromptStyle.Default
    prompt.HoldDuration = prompt.HoldDuration or 0

    if not prompt:GetAttribute("_ssprompt_hooked") then
        prompt:SetAttribute("_ssprompt_hooked", true)
        prompt.PromptButtonHoldBegan:Connect(function()
            pcall(function() fireproximityprompt(prompt) end)
        end)
    end
end

local function checkPrompt(prompt)
    if isStealOrSellPrompt(prompt) then
        enableStealOrSellPrompt(prompt)
    end
end

for _, obj in ipairs(game:GetDescendants()) do
    if obj:IsA("ProximityPrompt") then
        checkPrompt(obj)
    end
end

game.DescendantAdded:Connect(function(obj)
    if obj:IsA("ProximityPrompt") then
        checkPrompt(obj)
    end
end)

task.spawn(function()
    while true do
        for _, prompt in ipairs(workspace:GetDescendants()) do
            if prompt:IsA("ProximityPrompt") and not prompt:GetAttribute("_ssprompt_hooked") then
                if isStealOrSellPrompt(prompt) then
                    enableStealOrSellPrompt(prompt)
                end
            end
        end
        task.wait(2)
    end
end)

local autoPromptTP = true

local function setToggleUI(state)
    if state then
        toggleBtn.Text = "ON"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(33, 200, 112)
        status7.Text = "Prompt TP+Activate: ON"
        status7.TextColor3 = Color3.fromRGB(180,255,180)
    else
        toggleBtn.Text = "OFF"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        status7.Text = "Prompt TP+Activate: OFF"
        status7.TextColor3 = Color3.fromRGB(255,180,180)
    end
end

setToggleUI(true)

toggleBtn.MouseButton1Click:Connect(function()
    autoPromptTP = not autoPromptTP
    setToggleUI(autoPromptTP)
end)

local function getCharRoot()
    local char = player.Character or player.CharacterAdded:Wait()
    return char and char:FindFirstChild("HumanoidRootPart")
end

local function getPromptPart(prompt)
    local part = prompt.Parent
    if part:IsA("Attachment") or part:IsA("ProximityPrompt") then
        part = part.Parent
    end
    if part:IsA("Model") and part.PrimaryPart then
        part = part.PrimaryPart
    end
    if not part:IsA("BasePart") then
        for _, child in ipairs(part:GetChildren()) do
            if child:IsA("BasePart") then
                part = child
                break
            end
        end
    end
    return part
end

ProximityPromptService.PromptButtonHoldBegan:Connect(function(prompt)
    if not autoPromptTP then return end
    local root = getCharRoot()
    local part = getPromptPart(prompt)
    if root and part and part:IsA("BasePart") then
        pcall(function() ProximityPromptService.PromptButtonHoldEnded:Fire(prompt) end)
        task.wait(0.03)
        root.CFrame = part.CFrame * CFrame.new(0, 3, 0)
        task.wait(0.1)
        local wasEnabled = prompt.Enabled
        prompt.Enabled = false
        task.wait(0.05)
        prompt.Enabled = wasEnabled
        task.wait(0.05)
        pcall(function() fireproximityprompt(prompt) end)
    end
end)
